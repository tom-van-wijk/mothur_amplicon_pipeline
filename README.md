# mothur_amplicon_pipeline

**Licence:	GNU General Public License v3.0 (copy provided in directory)**<br />
Author:		Tom van Wijk<br />
Contact:	tom_van_wijk@hotmail.com<br />

### DESCRIPTION

This pipeline is developed to analyse and compare amplicon sequencing
datasets of bacterial populations sequenced using paired-end reads
generated with illumina technology. Currently only the 16S V4 / V3-4 regions
and Illumina paired-end data are supported.<br />

### REQUIREMENTS

-	Linux operating system. This software is developed on Linux Ubuntu 16.04<br />
	**Experiences when using different operating systems may vary.**
-	python 2.7.x
-	python libraries as listed in the import section of mothur_amplicon_pipeline.py
-	erne v2.1.1 or newer
-	fastQC
-	multiQC


### INSTALLATION

-	Clone the mothur_amplicon_pipeline repository to the desired location on your system.<br />
	`git clone https://github.com/tom-van-wijk/mothur_amplicon_pipeline.git`
-	Add the location of the mothur_amplicon_pipeline directory to the PATH variable:<br />
	`export PATH=$PATH:/path/to/mothur_amplicon_pipeline`<br />
	(It is recommended to add this command to your ~/.bashrc file)
-	Create path variable MOTHUR_AMPLICON_HOME to the mothur_amplicon_pipeline directory:<br />
	`export MOTHUR_AMPLICON_HOME=/path/to/mothur_amplicon_pipeline`<br />
	(It is recommended to add this command to your ~/.bashrc file)
-	Extract the database files, they are used as reference.

### USAGE

Start the pipeline with the following command:

`amplicon_pipeline.py -i 'inputdir' -o 'outputdir' -t 'threads'
-a 'amplicon' -x 'savetemp'`

-	**'inputdir':**	location of input directory. (required)<br />
			Should only contain either the uncompressed (.fastq)
			or compressed (.fastq.gz) sequence files containing the
			raw sequences of the forward and reverse reads.
			For each sample, these fastq files need to be named with
			an '_R1' or '_R2' tag respectively and  be furthermore identical.
			Optionally a samplesheet (.samplesheet) may be added to
			Specify the sequences of interest in the input directory.
			If not present, a samplesheet will be generated based
			on all fastq file-pairs in the input directory.
			The data is expected to be free of primer-, barcode- and adapter sequences.
			Quality trimming, filtering and ordering read-pairs is performed by the pipeline.			

-	**'outputdir':**	location of output directory.<br />
			Default = subdirectory in inputdir

-	**'threads':**	Number of threads (virtual cpu cores) to be used.<br />
			Default = 8.

-	**'amplicon':**	Name of the amplicon which is sequedced in the dataset.<br />
			Default = 16sv4 (Currently only the 16vs4 and 16sv34 amplicons supported.)<br />

-	**'savetemp':**	Set to true so save the temporary files and
			directories generated by the pipeline.<br />
			default = false

**The min_seq_size and max_seq_size dictionary values in function run_mothur_classify
in mothur_amplicon_pipeline.py might need to be finetuned for your specific dataset.
These are generally the expected sequenced target region size with a +10 and -10 bp margin.
The choice of primers used during sequencing will effect these values, if not set correctly,
you might lose a lot of contigs during the workflow.**

### ADDING NEW AMPLICONS

It is possible to add your own amplicons by adding the database files (if the existing ones
do not suffice) to the reference_files directory and adding a value to the following directories
in function run_mothur_classify in mothur_amplicon_pipeline.py:
- min_seq_size (expected target region size -10 bp)
- max_seq_size (expected target region size +10 bp)
- alignment_reference_database (name of alignment reference .fasta file)
- classification_reference_database_fasta (name of classification reference .fasta file)
- classification_reference_database_tax (name of classification reference .tax file)
The keys of the added values in all of these dictionaries should represent the name of the amplicon
and be identical. When starting the pipeline use the -a 'amplicon' parameter where 'amplicon'
is the name of the newly added amplicon.
